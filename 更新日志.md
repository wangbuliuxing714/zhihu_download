# 更新日志

## v2.1 (2025-11-15)

### 🎉 新增功能
- ✅ 全新现代化图形界面
- ✅ 自动使用系统代理，失败时自动切换直连
- ✅ 实时日志显示
- ✅ 多线程爬取，界面不卡顿
- ✅ 代理状态检测和提示
- ✅ Cookie配置可视化管理

### 🐛 Bug修复
- ✅ 修复Cookie中包含`%`符号导致的保存错误
- ✅ 修复代理错误导致的连接失败问题
- ✅ **修复文章内容中出现`</p>`等HTML标签的问题**
- ✅ 修复配置文件编码问题

### 🔧 改进优化
- ✅ 优化界面布局，所有组件可见
- ✅ 全面中文化界面
- ✅ 添加代理自动回退机制
- ✅ 清理HTML标签，输出纯文本内容
- ✅ 移除多余空白字符

### 📝 文档更新
- ✅ 添加GUI使用指南
- ✅ 添加Cookie获取教程
- ✅ 添加代理配置说明
- ✅ 添加功能特性说明

---

## 技术细节

### HTML标签清理
**问题**：爬取的文章中每个段落都有`</p>`标签

**原因**：知乎返回的内容是HTML格式，包含`<p>`、`</p>`等标签

**解决方案**：
```python
# 使用正则表达式移除所有HTML标签
clean_text = re.sub(r'<[^>]+>', '', item)
# 移除多余的空白字符
clean_text = clean_text.strip()
```

**效果**：
- 修复前：`这是一段文字</p>`
- 修复后：`这是一段文字`

### 代理自动回退
**问题**：系统配置了代理但代理软件未运行，导致连接失败

**解决方案**：
1. 首先尝试使用系统代理
2. 如果代理失败，自动切换到直连
3. 记录详细日志，方便排查问题

**代码逻辑**：
```python
try:
    # 尝试使用系统代理
    response = self.session.get(url, ...)
except requests.exceptions.ProxyError:
    # 代理失败，切换直连
    direct_session = requests.Session()
    direct_session.trust_env = False
    response = direct_session.get(url, ...)
```

---

## 使用建议

### 如果你已经爬取过文章
之前爬取的文章可能包含HTML标签，建议：
1. 删除旧文件
2. 重新爬取
3. 新文件将是纯文本格式

### 如何验证修复
1. 打开爬取的txt文件
2. 搜索`</p>`或`<p>`
3. 如果没有找到，说明修复成功

---

## 下一步计划

### 短期（1-2周）
- [ ] 添加文件保存路径选择
- [ ] 爬取完成后自动打开文件
- [ ] 添加批量爬取功能
- [ ] 优化字体解析速度

### 中期（1-2个月）
- [ ] 支持爬取整本书
- [ ] 支持导出为PDF/EPUB
- [ ] 添加书签管理
- [ ] 支持自定义主题

### 长期（3个月以上）
- [ ] 开发浏览器插件
- [ ] 支持云端同步
- [ ] 添加AI摘要功能
- [ ] 多平台支持

---

## 反馈与建议

如果你发现任何问题或有改进建议，请：
1. 在GitHub提交Issue
2. 发送邮件至：twaapot@gmail.com

感谢使用知乎盐选工具！🎉

